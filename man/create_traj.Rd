% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/create_traj.R
\name{create_traj}
\alias{create_traj}
\title{Create standardized trajectory object}
\usage{
create_traj(
  data,
  key_vars = list(id_col = "id", time_col = "time", y_col = "y"),
  tfilter = NULL
)
}
\arguments{
\item{data}{A data frame or tibble with longitudinal data}

\item{key_vars}{Named list defining column roles
Default: \code{list(id_col = "id", time_col = "time", y_col = "y")}}

\item{tfilter}{Function or \code{NULL} (default: >= non-NA \code{y} per subject)}
}
\value{
Object of class \code{"traj"} + one of \code{"traj_0"}, \code{"traj_1"}, \code{"traj_m"}
with attributes \code{data_info} (original metadata) and \code{status} ("empty", "one", "multiple")
}
\description{
Prepares a clean tibble with standardized columns \code{id}, \code{time}, \code{y}
from a longitudinal dataset. Removes rows with missing key values,
then applies user-specified or default filtering.

The returned object has class \code{"traj"} plus one of:
\itemize{
\item \code{"traj_0"} – empty (zero rows/subjects)
\item \code{"traj_1"} – single trajectory / subject
\item \code{"traj_m"} – multiple trajectories / subjects
}

Metadata is attached as attributes \code{data_info} and \code{status}.
}
\examples{
\dontrun{
# ── Basic usage (multiple subjects) ──────────────────────────────────────────
traj_m <- create_traj(example_data)

class(traj_m)                        # "traj_m" "traj" ...
attr(traj_m, "status")               # "multiple"
attr(traj_m, "data_info")$data_name  # "example_data"


# ── Single-subject input → different class ────────────────────────────────
one_id <- unique(example_data$id)[1]
one_subject <- example_data |> dplyr::filter(id == one_id)

traj_1 <- create_traj(one_subject)
class(traj_1)                        # "traj_1" "traj" ...
attr(traj_1, "status")               # "one"


# ── Explicit key_vars (when column names differ) ────────────────────────────
traj_explicit <- create_traj(
  data = example_data,
  key_vars = list(
    id_col   = "id",
    time_col = "time",
    y_col    = "y"
  )
)
identical(traj_explicit, traj_m)     # TRUE when names match


# --- Custom tfilter: keep subjects with max(y) >= 100 ──────────────────────────
traj_high <- create_traj(
  example_data,
  tfilter = function(d) {
    d |>
      dplyr::group_by(id) |>
      dplyr::summarise(max_y = max(y, na.rm = TRUE)) |>
      dplyr::mutate(keep = max_y >= 100) |>
      dplyr::right_join(d, by = "id") |>
      dplyr::pull(keep)
  }
)
attr(traj_high, "status")            # "multiple" or "one"


# ── Invalid input (caught early) ─────────────────────────────────────────────
# Duplicate source column → error
# create_traj(
#   example_data,
#   key_vars = list(id_col = "id", time_col = "id", y_col = "y")
# )
# → Error: Duplicate column names in key_vars
}

}
